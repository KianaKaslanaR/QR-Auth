<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data and Device Info Receiver</title>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
  <h1>Data and Device Info Receiver</h1>
  <script>
    // 获取URL中的查询参数
    const urlParams = new URLSearchParams(window.location.search);
    // 通过 'data' 参数获取传入的数据
    const inputData = urlParams.get('data');

    // 获取浏览器信息
    const browserInfo = {
      userAgent: window.navigator.userAgent,
    };

    // 筛选特定User Agent
    const user_agent = browserInfo.userAgent;
    if (user_agent.includes("com.alibaba.android.rimet")) {
      const dingTalkIndex = user_agent.indexOf("DingTalk");
      if (dingTalkIndex !== -1) {
        const dingTalkInfo = user_agent.substring(dingTalkIndex);
        const versionIndex = dingTalkInfo.indexOf("DingTalk/") + 9; // 9 是 "DingTalk/" 的长度
        const version = versionIndex !== -1 ? dingTalkInfo.substring(versionIndex, dingTalkInfo.indexOf(")")) : "未知版本";

        // 使用AJAX发送请求到 https://whatismyipaddress.com/
        $.get("https://whatismyipaddress.com/", function(data) {
          // 从返回结果中提取用户的 IP 地址
          const userPublicIP = $(data).find('.ipv4').text() || "未能获取IP";

          // 获取操作系统信息
          const osIndexStart = user_agent.indexOf("Linux; U; ") + 10; // 10 是 "Linux; U; " 的长度
          const osIndexEnd = user_agent.indexOf(";", osIndexStart);
          const osInfo = osIndexEnd !== -1 ? user_agent.substring(osIndexStart, osIndexEnd) : "未知操作系统";

          // 在页面上显示用户信息
          document.body.innerHTML += `<p>您好，${userPublicIP}</p>`;
          document.body.innerHTML += `<p>您正在使用${user_agent.substring(user_agent.indexOf("Build/") + 6, user_agent.indexOf(";"))}进行认证操作</p>`;
          document.body.innerHTML += `<p>您的操作系统：${osInfo}</p>`;
          document.body.innerHTML += `<p>您的DingTalk版本：${version}</p>`;
        });
      }
    } else {
      document.body.innerHTML += `<p>未检测到特定User Agent</p>`;
    }
  </script>
</body>
</html>
