<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Auth</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('background.png') center/cover fixed no-repeat; /* 修改背景显示方式 */
    }

    .background-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.6); /* 半透明白色背景，透明度为0.6 */
      z-index: -1; /* 将该层放在最底层 */
    }

    .info-container-wrapper {
      position: relative;
      z-index: 1; /* 将该层放在上层 */
      max-width: 600px; /* 设置最大宽度，使内容不过分拉宽 */
      margin: auto; /* 居中显示 */
    }

    .info-container {
      background-color: rgba(255, 255, 255, 0.6); /* 透明背景 */
      height: 100%
      z-index: 0
      border-radius: 15px; /* 圆角矩形边框 */
      padding: 20px;
    }

    p, h2 {
      display: inline;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="background-overlay"></div>
  <div class="info-container-wrapper">
    <div class="info-container">
      <script>
        // 获取URL中的查询参数
        const urlParams = new URLSearchParams(window.location.search);
        // 通过 'key' 参数获取传入的数据
        const keyData = urlParams.get('key');
        // 通过 'dv_name' 参数获取传入的设备名称
        const deviceName = urlParams.get('dv_name');
        // 获取浏览器信息
        const browserInfo = {
          userAgent: window.navigator.userAgent,
        };
        // 筛选特定User Agent
        const user_agent = browserInfo.userAgent;
        if (user_agent.includes("com.alibaba.android.rimet")) {
          const dingTalkIndex = user_agent.indexOf("DingTalk");
          if (dingTalkIndex !== -1) {
            const buildIndex = user_agent.indexOf("Build/");
            const deviceInfo = buildIndex !== -1 ? user_agent.substring(buildIndex, user_agent.indexOf(";", buildIndex)) : "未知设备信息";
            const dingTalkInfo = user_agent.substring(dingTalkIndex);
            const versionIndex = dingTalkInfo.indexOf("DingTalk/") + 9; // 9 是 "DingTalk/" 的长度
            const version = versionIndex !== -1 ? dingTalkInfo.substring(versionIndex, dingTalkInfo.indexOf(")")) : "未知版本";
            // 获取操作系统信息
            const osIndexStart = user_agent.indexOf("Linux; U; ") + 10; // 10 是 "Linux; U; " 的长度
            const osIndexEnd = user_agent.indexOf(";", osIndexStart);
            const osInfo = osIndexEnd !== -1 ? user_agent.substring(osIndexStart, osIndexEnd) : "未知操作系统";
            // 在页面上显示用户信息
            document.body.innerHTML += `<p>您正在使用${deviceInfo}进行认证操作</p>`;
            document.body.innerHTML += `<p>您的操作系统：${osInfo}</p>`;
            document.body.innerHTML += `<p>您的DingTalk版本：${version}</p> <br><br>`;
            document.body.innerHTML += `<p>您在这为</p> <h2>${deviceName || '未传入设备名称'}</h2> <p>进行认证</p><br>`;
            document.body.innerHTML += `<p>认证密钥🔐:</p> <h2>${keyData || '未传入key'}</h2>`;
          }
        } else {
          // 如果未检测到特定User Agent，跳转到 about:blank
          window.location.href = "about:blank";
        }
      </script>
    </div>
  </div>
</body>
</html>
